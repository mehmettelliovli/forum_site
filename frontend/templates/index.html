<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Tellioglu Forum</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              {% if category == 'login_success' %}
                <div class="flash success" style="margin-bottom:18px;">{{ message }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endwith %}
        <header>tellioglu forum</header>
        <hr>
        <nav>
      <a href="{{ url_for('home') }}">anasayfa</a>
      <a href="{{ url_for('topics') }}">tartismalar</a>
      <a href="{{ url_for('members') }}">uyeler</a>
      {% if user.is_authenticated %}
        <a href="{{ url_for('profile') }}">profil</a>
        <a href="{{ url_for('logout') }}">çıkış</a>
      {% else %}
        <a href="{{ url_for('signup') }}">üye ol</a>
        <a href="{{ url_for('login') }}">giriş</a>
      {% endif %}
        </nav>
        <hr>
        <section class="topics-section">
            <h2>güncel tartışmalar</h2>
            <hr>
            {% for post in posts %}
            <div class="topic">
                <div class="topic-title"><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title }}</a></div>
                <div class="meta-info">
                    {{ post.author.username }} – {{ post.created_at.strftime('%d.%m.%Y') }} | {{ post.category.name }}
                    {% if user.is_authenticated %}
                        
                    {% endif %}
                </div>
            </div>
            <hr>
            {% endfor %}
        </section>
        {% if user.is_authenticated %}
          <div class="fab" id="fabBtn">Tartışma Oluştur</div>
          <div class="modal-bg" id="modalBg" style="display:none;">
            <div class="modal">
              <span class="modal-close" id="modalClose">&times;</span>
              <h2>Yeni Tartışma Oluştur</h2>
              <form id="modalForm" action="{{ url_for('create_tartisma') }}" method="post">
                <div class="form-group">
                  <label for="title">Başlık:</label>
                  <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                  <label for="content">İçerik:</label>
                  <textarea id="content" name="content" rows="5" required></textarea>
                </div>
                <div class="form-group">
                  <label for="category">Kategori:</label>
                  <select id="category" name="category_id" required>
                    <option value="">Kategori seçiniz</option>
                    {% for cat in categories %}
                      <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                  </select>
                </div>
                <button type="submit">Tartışma Oluştur</button>
              </form>
            </div>
          </div>
          <script>
            const fab = document.getElementById('fabBtn');
            const modalBg = document.getElementById('modalBg');
            const modalClose = document.getElementById('modalClose');
            fab.onclick = () => { modalBg.style.display = 'flex'; };
            modalClose.onclick = () => { modalBg.style.display = 'none'; };
            window.onclick = (e) => { if(e.target === modalBg) modalBg.style.display = 'none'; };
          </script>
        {% endif %}
    </div>

</body>

</html>
